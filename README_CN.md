# Sequencium - 基于搜索算法的实现

基于 Walter Joris 设计的 **Sequencium** 游戏的命令行实现，采用带有 Alpha-Beta 剪枝的 Minimax 搜索算法的 AI 玩家。

**🚀 新功能：C++ 优化搜索引擎** - 核心搜索算法使用 C++ 实现，速度提升 100-600 倍！

## 游戏规则

### 游戏目标
两名玩家在方格棋盘上扩展自己的数字序列，游戏结束时数字最大的玩家获胜。

### 游戏准备
- **棋盘**：方格网格（默认 6×6，可配置）
- **玩家**：2 名玩家（A 和 B）
- **开局位置**：
  - 玩家 A 在左上角 (0,0) 放置 `1`
  - 玩家 B 在右下角放置 `1`

### 核心规则
1. **每回合**：选择一个空格，该空格必须与你的任意一个数字相邻（8个方向）
2. **新数字**：放置的数字 = 相邻数字 + 1
3. **约束条件**：
   - 一个格子只能包含一个数字
   - 只能从自己的数字扩展
   - 如果有有效移动就不能跳过回合
   - 允许对角线移动

### 游戏结束
- 当双方都没有有效移动时游戏结束
- 胜者是棋盘上拥有最大数字的玩家
- 如果双方最大数字相同则为平局

## 功能特性

- ✅ 完整的游戏逻辑实现
- ✅ **C++ 优化搜索引擎（快 100-600 倍！）**
- ✅ 带有 Alpha-Beta 剪枝的 Minimax 搜索算法
- ✅ **Stockfish 启发的优化：**
  - 置换表（位置缓存的哈希表）
  - 移动排序以实现更好的剪枝
  - 优化的棋盘表示
- ✅ 可配置棋盘大小
- ✅ 可配置 AI 搜索深度
- ✅ 命令行界面与可视化棋盘显示
- ✅ 移动分析和统计信息
- ✅ 如果 C++ 不可用，自动回退到 Python

## 安装

### 系统要求
- Python 3.6+
- C++ 编译器（g++ 或 clang++）用于优化性能
- pybind11（用于 Python-C++ 绑定）

### 快速安装

```bash
# 安装 Python 依赖
pip install pybind11

# 编译 C++ 扩展
python3 setup.py build_ext --inplace

# 使脚本可执行（可选）
chmod +x sequencium.py
```

### 不使用 C++ 优化

如果不想编译 C++ 扩展，代码会自动回退到纯 Python 实现：

```bash
# 直接运行 - 无需编译
python3 sequencium.py
```

## 使用方法

### 基本用法
```bash
python3 sequencium.py
```

### 自定义棋盘大小
```bash
python3 sequencium.py 8  # 8x8 棋盘
```

### 自定义 AI 深度
```bash
python3 sequencium.py 6 5  # 6x6 棋盘，深度 5 搜索
```

### 交互模式（每步之间暂停）
```bash
python3 sequencium.py 6 4 interactive
```

## 命令行参数

```
python3 sequencium.py [board_size] [ai_depth] [interactive]

参数说明：
  board_size  - 方形棋盘的大小（默认：6）
  ai_depth    - AI 算法的搜索深度（默认：4）
  interactive - 启用交互模式（每步后暂停）
```

## 示例输出

```
╔══════════════════════════════════════════════════════════╗
║         SEQUENCIUM - AI Search Algorithm Demo            ║
║              Based on Walter Joris' Game                 ║
╚══════════════════════════════════════════════════════════╝

配置信息：
  棋盘大小：6x6
  AI 搜索深度：4
  交互模式：False

==================================================
SEQUENCIUM 游戏
棋盘大小：6x6
AI 搜索深度：4
==================================================

初始棋盘：
    0  1  2  3  4  5
  +------------------+
 0|A1  .  .  .  .  .|
 1| .  .  .  .  .  .|
 2| .  .  .  .  .  .|
 3| .  .  .  .  .  .|
 4| .  .  .  .  .  .|
 5| .  .  .  .  . B1|
  +------------------+

==================================================
回合 1：玩家 A 的回合
可用移动数：3
AI 选择：第 0 行，第 1 列，值 2
评估节点数：1234

...

==================================================
游戏结束！
==================================================

最终棋盘：
    0  1  2  3  4  5
  +------------------+
 0|A1 A2 A3 A4 A5 A6|
 1|A2 A3 A4 A5 A6 A7|
 2|A3 A4 A5 A6 A7 A8|
 3|B4 B5 B6 B7 A8 A9|
 4|B3 B4 B5 B6 B7 A8|
 5|B2 B3 B4 B5 B6 B7|
  +------------------+

玩家 A 最大值：9
玩家 B 最大值：7
总移动次数：34

🎉 获胜者：玩家 A！
==================================================
```

## 算法详情

### 架构
- **高层控制**：Python（游戏逻辑、UI、配置）
- **核心搜索引擎**：C++（极小极大算法、移动生成、评估）
- **接口**：pybind11 实现 Python-C++ 无缝集成

### 搜索算法
AI 使用带有 **Alpha-Beta 剪枝**的 **Minimax** 算法来寻找最优移动。

### Stockfish 启发的优化

C++ 实现采用了国际象棋引擎 Stockfish 的几种技术：

1. **置换表**：缓存先前评估的位置以避免冗余计算
   - 使用 Zobrist 风格的哈希
   - 存储位置评估、深度和最佳移动
   - 显著减少评估的节点（减少 50-85%）

2. **移动排序**：优先评估有希望的移动以实现更好的 alpha-beta 剪枝
   - 优先考虑值更高的移动
   - 中心控制奖励
   - 导致更早的剪枝和更快的搜索

3. **优化的数据结构**：使用数组的快速棋盘表示
   - 常数时间位置查找
   - 高效的移动生成
   - 搜索期间最小的内存分配

### 评估函数
位置评估考虑以下因素：
1. **最大值差异**（权重：100）- 主要获胜条件
2. **控制格子数**（权重：10）- 控制的格子数量
3. **机动性**（权重：1）- 可用移动数量

### 性能表现
- **C++ 引擎**（带优化）：
  - 搜索深度 4：每步约 100-400 个节点，**<1ms**
  - 搜索深度 5：每步约 300-1000 个节点，**<1ms**
  - 搜索深度 6：每步约 1000-5000 个节点，**1-10ms**

- **Python 引擎**（回退）：
  - 搜索深度 4：每步约 1000-5000 个节点（快速）
  - 搜索深度 5：每步约 10000-50000 个节点（较慢但更智能）
  - 搜索深度 6+：大棋盘可能较慢

**加速比**：C++ 实现比纯 Python **快 100-600 倍**！

## 实现细节

### 核心类

- **`Player`**：玩家 A 和玩家 B 的枚举
- **`GameBoard`**：管理游戏状态、有效移动和游戏规则（Python）
- **`SequenciumAI`**：高层 AI 接口（Python）
  - 协调 Python 游戏逻辑和 C++ 搜索
  - 如果 C++ 不可用，自动回退到 Python
- **`SearchEngine`**：优化的搜索实现（C++）
  - 带 alpha-beta 剪枝的 Minimax
  - 置换表
  - 移动排序

### 棋盘表示

棋盘使用二维数组，每个格子包含：
- 空格子为 `None`
- 被占用的格子为 `(Player, value)` 元组

## 测试

运行单元测试：

```bash
python3 test_sequencium.py
```

## 示例游戏

参见 `EXAMPLES.md` 文件查看不同配置下的游戏示例输出。

## 许可证

MIT 许可证 - 详见 LICENSE 文件

## 作者

实现：Colin Wang (2026)  
基于：Walter Joris 的 Sequencium 游戏
